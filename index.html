<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NeoLearn Experience</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f0f8ff, #e0f2fe);
      font-family: 'Montserrat', sans-serif;
      color: #333;
    }
    .main-interface {
      width: 100%;
      max-width: 1200px;
      padding: 20px;
    }
    .header-logo {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      display: block;
      margin-bottom: 20px;
    }
    .branding {
      text-align: center;
      max-width: 800px;
      margin: 0 auto 40px auto;
    }
    .main-container {
      display: flex;
      width: 90%;
      max-width: 1100px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin: 0 auto;
    }
    .left-section, .right-section {
      flex: 1;
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .scene-button {
      padding: 16px 30px;
      font-size: 16px;
      border-radius: 8px;
      background: linear-gradient(135deg, #63a4ff, #007bff);
      color: white;
      cursor: pointer;
      font-weight: 600;
      margin: 10px 0;
    }
    .input-field {
      padding: 14px;
      font-size: 16px;
      border-radius: 8px;
      width: 80%;
      margin-bottom: 15px;
    }
    #displayArea {
      margin-top: 15px;
      font-size: 1.1em;
      color: #444;
      background-color: #f9f9f9;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      min-width: 80%;
    }
    #unity-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 1000;
      display: none;
    }
    #return-button {
      position: absolute;
      top: 20px;
      left: 20px;
    }
  </style>
</head>
<body>
  <div class="main-interface">
    <img src="logo.png" alt="NeoLearn Logo" class="header-logo" />
    <div class="branding">
      <h1>NeoLearn Experience</h1>
      <p>Explore immersive learning environments with NeoLearn.</p>
    </div>
    <div class="main-container">
      <div class="left-section">
        <button id="btnSpace" class="scene-button">Space</button>
        <button id="btnHeart" class="scene-button">Heart</button>
      </div>
      <div class="right-section">
        <input type="text" id="userInput" class="input-field" placeholder="Enter audio URL" />
        <button id="previewButton" class="scene-button">Preview URL</button>
        <div id="displayArea"></div>
      </div>
    </div>
  </div>

  <div id="unity-container">
    <canvas id="unity-canvas"></canvas>
    <button id="return-button" class="scene-button">Return to Menu</button>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("btnSpace").addEventListener("click", () => loadUnityProject("Space"));
      document.getElementById("btnHeart").addEventListener("click", () => loadUnityProject("Heart"));
      document.getElementById("previewButton").addEventListener("click", displayInput);
      document.getElementById("return-button").addEventListener("click", returnToMainInterface);
    });

    let currentUnityInstance = null;
    let currentProject = "";

    window.loadUnityProject = function (project) {
      console.log(`[Load] Loading Unity project: ${project}`);
      currentProject = project;
      document.getElementById("unity-container").style.display = "block";
      document.querySelector(".main-interface").style.display = "none";
      initializeUnityBuild(project);
    };

    window.returnToMainInterface = function () {
      console.log("[UI] Returning to main interface");
      document.getElementById("unity-container").style.display = "none";
      document.querySelector(".main-interface").style.display = "block";
    };

    window.displayInput = function () {
      const inputField = document.getElementById("userInput");
      const displayArea = document.getElementById("displayArea");
      const value = inputField.value.trim();
      displayArea.textContent = value ? `Audio Source: ${value}` : "No audio URL provided";
    };

    function initializeUnityBuild(project) {
      console.log(`[Unity] Initializing build for: ${project}`);
      const buildPath = `Build/${project}/`;
      const config = {
        dataUrl: buildPath + "WebGL.data",
        frameworkUrl: buildPath + "WebGL.framework.js",
        codeUrl: buildPath + "WebGL.wasm",
        companyName: "NeoLearn",
        productName: project,
        productVersion: "1.0",
      };

      document.getElementById("unity-container").innerHTML = '<canvas id="unity-canvas"></canvas>';
      const canvas = document.getElementById("unity-canvas");

      const script = document.createElement("script");
      script.src = buildPath + "WebGL.loader.js?v=" + Date.now();
      script.onload = () => {
        console.log("[Loader] Script loaded");
        createUnityInstance(canvas, config, (progress) => {
          console.log(`[Loader] Progress: ${Math.round(progress * 100)}%`);
        })
        .then((instance) => {
          console.log("[Unity] Instance created");
          currentUnityInstance = instance;
          handleAudioPlayback();
        })
        .catch((error) => {
          console.error("[Unity] Failed to create instance:", error);
          alert("Failed to load Unity experience.");
          returnToMainInterface();
        });
      };
      script.onerror = () => {
        console.error("[Loader] Failed to load script:", script.src);
        alert("Failed to load Unity project.");
        returnToMainInterface();
      };
      document.body.appendChild(script);
    }

    function handleAudioPlayback() {
      const audioUrl = document.getElementById("userInput").value;
      if (audioUrl) {
        console.log(`[Audio] Playing: ${audioUrl}`);
        try {
          currentUnityInstance.SendMessage("AudioManager", "PlayAudio", audioUrl);
        } catch (error) {
          console.error("[Audio] Error:", error);
        }
      } else {
        console.log("[Audio] No audio URL provided");
      }
    }

    window.addEventListener("resize", () => {
      if (currentUnityInstance) {
        currentUnityInstance.SetFullscreen(0);
      }
    });
  </script>
</body>
</html>
